{% comment %}
  Main Cart Items Section
{% endcomment %}

{%- style -%}
  .cart-items {
    padding: 4rem 2rem;
  }

  @media screen and (min-width: 750px) {
    .cart-items {
      padding: 6rem 4rem;
    }
  }

  .cart-items__wrapper {
    max-width: var(--page-width);
    margin: 0 auto;
  }

  .cart-items__title {
    font-size: 3.6rem;
    font-weight: 700;
    color: rgb(var(--black));
    text-transform: uppercase;
    letter-spacing: 0.2rem;
    margin-bottom: 3rem;
    text-align: center;
  }

  .cart-items__empty {
    text-align: center;
    padding: 6rem 2rem;
  }

  .cart-items__empty-text {
    font-size: 1.8rem;
    margin-bottom: 2rem;
    color: rgba(var(--black), 0.7);
  }

  .cart-items__empty-button {
    display: inline-block;
    padding: 1.5rem 3rem;
    background-color: rgb(var(--gold));
    color: rgb(var(--black));
    text-decoration: none;
    font-weight: 700;
    font-size: 1.6rem;
    text-transform: uppercase;
    letter-spacing: 0.1rem;
    transition: all 0.3s ease;
    border: 2px solid rgb(var(--gold));
  }

  .cart-items__empty-button:hover {
    background-color: rgb(var(--black));
    border-color: rgb(var(--black));
    color: rgb(var(--white));
  }

  .cart-items__table {
    width: 100%;
    border-collapse: collapse;
  }

  .cart-items__header {
    border-bottom: 2px solid rgba(var(--black), 0.1);
  }

  .cart-items__header th {
    padding: 1.5rem;
    text-align: left;
    font-size: 1.4rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05rem;
    color: rgba(var(--black), 0.7);
  }

  @media screen and (max-width: 749px) {
    .cart-items__header {
      display: none;
    }
  }

  .cart-item {
    border-bottom: 1px solid rgba(var(--black), 0.1);
  }

  .cart-item__cell {
    padding: 2rem 1.5rem;
    vertical-align: middle;
  }

  @media screen and (max-width: 749px) {
    .cart-item {
      display: grid;
      grid-template-columns: 100px 1fr;
      gap: 1.5rem;
      padding: 2rem 0;
    }

    .cart-item__cell {
      padding: 0;
    }
  }

  .cart-item__image {
    width: 100px;
    height: 100px;
    object-fit: cover;
  }

  .cart-item__details {
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  @media screen and (max-width: 749px) {
    .cart-item__details {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
  }

  .cart-item__title {
    font-size: 1.6rem;
    font-weight: 600;
    color: rgb(var(--black));
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .cart-item__title:hover {
    color: rgb(var(--gold));
  }

  .cart-item__variant {
    font-size: 1.4rem;
    color: rgba(var(--black), 0.6);
    margin-top: 0.5rem;
  }

  .cart-item__price {
    font-size: 1.8rem;
    font-weight: 600;
    color: rgb(var(--gold));
  }

  .cart-item__quantity {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .cart-item__quantity-input {
    width: 60px;
    text-align: center;
    padding: 0.8rem;
    border: 1px solid rgba(var(--black), 0.2);
    font-size: 1.4rem;
  }

  .cart-item__quantity-button {
    width: 32px;
    height: 32px;
    border: 1px solid rgba(var(--black), 0.2);
    background-color: rgb(var(--white));
    cursor: pointer;
    font-size: 1.8rem;
    transition: all 0.3s ease;
  }

  .cart-item__quantity-button:hover {
    background-color: rgb(var(--gold));
    border-color: rgb(var(--gold));
  }

  .cart-item__remove {
    background: none;
    border: none;
    color: rgba(var(--black), 0.6);
    cursor: pointer;
    font-size: 1.4rem;
    text-decoration: underline;
    transition: color 0.3s ease;
  }

  .cart-item__remove:hover {
    color: rgb(var(--gold));
  }

  .cart-item__total {
    font-size: 1.8rem;
    font-weight: 700;
    color: rgb(var(--black));
    text-align: right;
  }
{%- endstyle -%}

<div class="cart-items">
  <div class="cart-items__wrapper">
    <h1 class="cart-items__title">{{ 'sections.cart.title' | t }}</h1>

    {%- if cart.item_count == 0 -%}
      <div class="cart-items__empty">
        <p class="cart-items__empty-text">{{ 'sections.cart.empty' | t }}</p>
        <a href="{{ routes.all_products_collection_url }}" class="cart-items__empty-button">
          {{ 'general.continue_shopping' | t }}
        </a>
      </div>
    {%- else -%}
      <form action="{{ routes.cart_url }}" method="post" novalidate>
        <table class="cart-items__table">
          <thead class="cart-items__header">
            <tr>
              <th colspan="2">{{ 'sections.cart.headings.product' | t }}</th>
              <th>{{ 'sections.cart.headings.price' | t }}</th>
              <th>{{ 'sections.cart.headings.quantity' | t }}</th>
              <th>{{ 'sections.cart.headings.total' | t }}</th>
            </tr>
          </thead>
          <tbody>
            {%- for item in cart.items -%}
              <tr class="cart-item" data-line="{{ forloop.index }}">
                <td class="cart-item__cell">
                  {%- if item.image -%}
                    <img src="{{ item.image | image_url: width: 200 }}"
                         alt="{{ item.title | escape }}"
                         class="cart-item__image"
                         loading="lazy">
                  {%- endif -%}
                </td>
                <td class="cart-item__cell">
                  <div class="cart-item__details">
                    <div>
                      <a href="{{ item.url }}" class="cart-item__title">
                        {{ item.product.title }}
                      </a>
                      {%- unless item.variant.title contains 'Default' -%}
                        <div class="cart-item__variant">{{ item.variant.title }}</div>
                      {%- endunless -%}
                    </div>
                  </div>
                </td>
                <td class="cart-item__cell">
                  <div class="cart-item__price">{{ item.final_price | money }}</div>
                </td>
                <td class="cart-item__cell">
                  <div class="cart-item__quantity">
                    <button type="button" 
                            class="cart-item__quantity-button"
                            data-action="decrease"
                            data-line="{{ forloop.index }}">-</button>
                    <input type="number"
                           name="updates[]"
                           value="{{ item.quantity }}"
                           min="0"
                           class="cart-item__quantity-input"
                           data-line="{{ forloop.index }}">
                    <button type="button" 
                            class="cart-item__quantity-button"
                            data-action="increase"
                            data-line="{{ forloop.index }}">+</button>
                  </div>
                  <button type="button" 
                          class="cart-item__remove"
                          data-line="{{ forloop.index }}">
                    {{ 'sections.cart.remove' | t }}
                  </button>
                </td>
                <td class="cart-item__cell">
                  <div class="cart-item__total">{{ item.final_line_price | money }}</div>
                </td>
              </tr>
            {%- endfor -%}
          </tbody>
        </table>
      </form>
    {%- endif -%}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const quantityButtons = document.querySelectorAll('.cart-item__quantity-button');
    const quantityInputs = document.querySelectorAll('.cart-item__quantity-input');
    const removeButtons = document.querySelectorAll('.cart-item__remove');

    quantityButtons.forEach(button => {
      button.addEventListener('click', function() {
        const line = this.getAttribute('data-line');
        const input = document.querySelector(`.cart-item__quantity-input[data-line="${line}"]`);
        const action = this.getAttribute('data-action');
        let quantity = parseInt(input.value);

        if (action === 'increase') {
          quantity++;
        } else if (action === 'decrease' && quantity > 1) {
          quantity--;
        }

        input.value = quantity;
        updateCart(line, quantity);
      });
    });

    quantityInputs.forEach(input => {
      input.addEventListener('change', function() {
        const line = this.getAttribute('data-line');
        const quantity = parseInt(this.value);
        updateCart(line, quantity);
      });
    });

    removeButtons.forEach(button => {
      button.addEventListener('click', function() {
        const line = this.getAttribute('data-line');
        updateCart(line, 0);
      });
    });

    function updateCart(line, quantity) {
      fetch('/cart/change.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          line: line,
          quantity: quantity
        })
      })
      .then(response => response.json())
      .then(data => {
        window.location.reload();
      })
      .catch(error => {
        console.error('Error:', error);
      });
    }
  });
</script>

{% schema %}
{
  "name": "t:sections.main-cart-items.name",
  "settings": []
}
{% endschema %}
